#!/bin/sh
# Removing set -e to prevent script from exiting on errors

case "$1" in
    install|upgrade)
        # Check if BPF functionality is available in the kernel
        if [ -f "/proc/sys/net/core/bpf_jit_enable" ]; then
            echo "BPF JIT support detected in kernel."
        else
            echo "Warning: BPF JIT support not detected in kernel."
            echo "The program may not work correctly on this system."
        fi
        
        # No need to load BPF as a module - it's built into most modern kernels
        # Just ensuring the BPF filesystem is ready
        
        # Check if BPF filesystem is available
        if [ ! -d /sys/fs/bpf ]; then
            echo "Creating BPF filesystem mount point..."
            mkdir -p /sys/fs/bpf
        fi
    ;;

    abort-upgrade)
    ;;

    *)
        echo "preinst does not recognize argument '$1'" >&2
        exit 1
    ;;
esac

# Force successful exit
exit 0 